---
output:
  html_document:
    toc: true
    toc_depth: 5
    includes:
      in_header: 2_Assets/header.Rhtml
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(raster)
library(ggmap)
library(rgdal)
require(mapproj)
require(knitr)
require(patchwork)
require(lubridate)

airbnb <- read_csv('1_Data/airbnb.csv')
berlin <- readRDS('1_Data/berlin.RDS')

theme_set(theme_minimal())
```


### Neueinstellungen

#### Entwicklung

:::::: {.columns style="display: flex;"}
::: {.column width="40%"}
Seit `r strftime(min(airbnb$Erstellungsdatum), "%d.%m.%Y")` wurden in Berlin `r nrow(airbnb)` Airbnb Wohnungen eingestellt. Von diesen Wohnungn weisen aktuell `r round(mean(airbnb$Verfügbarkeit_90Tage > 0) * 100)`% Verfügbarkeiten von durchschnittlich `r round(mean(airbnb$Verfügbarkeit_90Tage[airbnb$Verfügbarkeit_90Tage>0]),1)` Tagen für die nächsten 3 Monate auf.

**Einstellungen von AirBnB Wohnungen haben über die letzten Jahre rasant zugenommen.** 
:::

::: {.column width="5%"}
:::

::: {.column width="55%"}

```{r message = F, echo = F, fig.asp=.3}
ggplot(airbnb %>% filter(Erstellungsdatum > "2018-01-01", 
                         Erstellungsdatum < "2019-12-31") %>% 
         group_by(Jahr = year(Erstellungsdatum), month = month(Erstellungsdatum)) %>% 
         summarize(
           Monat = forcats::as_factor(paste(first(Jahr), first(month), sep = '-')),
           Wohnungen = n()), 
       aes(x = Monat, y = Wohnungen, fill = Jahr)) + 
  geom_bar(stat='identity', position='dodge') + 
  theme(legend.position = 'none',
        axis.text.x = element_text(angle = 45, hjust = 1))

```

:::
::::::

#### Stadteile

:::::: {.columns style="display: flex;"}
::: {.column width="40%"}

The figure on the left-hand side shows the `cars` data.

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut
enim ad minim veniam, quis nostrud exercitation ullamco laboris
nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor
in reprehenderit in voluptate velit esse cillum dolore eu fugiat
nulla pariatur.

:::
::: {.column width="5%"}
:::

::: {.column width="55%"}
```{r message = F, echo = F, fig.asp=.3}

ggplot(airbnb %>% filter(Erstellungsdatum > "2018-01-01", 
                         Erstellungsdatum < "2019-12-31") %>% 
         group_by(Stadtteil, Jahr = year(Erstellungsdatum)) %>% 
         summarize(Wohnungen = n()), 
       aes(y = Stadtteil, x = Wohnungen, group = Jahr, fill = Jahr)) + 
  geom_bar(stat='identity', position='dodge') + 
  theme(legend.position = 'none')

```


```{r echo = F}
ggmap(berlin) + 
  theme(axis.title = element_blank(),
        axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  coord_map(ylim=c(52.45,52.58)) +
  geom_point(airbnb %>% filter(Erstellungsdatum > "2018-01-01", 
                         Erstellungsdatum < "2019-12-31"), 
             mapping = aes(x = Längengrad, y = Breitengrad, col = year(Erstellungsdatum)),size=.1) + 
  theme(legend.position = 'none')
```


:::

::::::

### Preis

#### Prädiktoren





