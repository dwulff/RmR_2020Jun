---
output:
  pdf_document:
    includes:
      before_body: 2_Assets/header.Rhtml
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(raster)
library(ggmap)
library(rgdal)
require(mapproj)
require(knitr)
require(patchwork)

airbnb <- read_csv('1_Data/airbnb.csv')
berlin <- readRDS('1_Data/berlin.RDS')

theme_set(theme_minimal())
```


### Entwicklung

#### Zeitlicher Verlauf

Seit `r strftime(min(airbnb$Erstellungsdatum), "%d.%m.%Y")` wurden in Berlin `r nrow(airbnb)` Airbnb Wohnungen eingestellt. Von diesen Wohnungn weisen aktuell `r round(mean(airbnb$Verfügbarkeit_90Tage > 0) * 100)`% Verfügbarkeiten von durchschnittlich `r round(mean(airbnb$Verfügbarkeit_90Tage[airbnb$Verfügbarkeit_90Tage>0]),1)` Tagen für die nächsten 3 Monate auf.    

Einstellungen von AirBnB Wohnungen haben über die letzten Jahre rasant zugenommen. 

```{r fig.asp=1,echo = F, fig.asp=.25}
ggplot(airbnb, aes(x = Erstellungsdatum)) + geom_histogram() + labs(y = "Häufigkeit")
```


### Räumliche Verteilung

#### Stadteile

:::::: {.columns style="display: flex;"}

::: {.column width="55%"}
```{r message = F, echo = F, fig.asp=.3}
ggplot(airbnb, aes(y = Stadtteil)) + geom_bar()

```
:::

::: {.column width="5%"}
\
<!-- an empty Div (with a white space), serving as
a column separator -->
:::

::: {.column width="40%"}
The figure on the left-hand side shows the `cars` data.

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut
enim ad minim veniam, quis nostrud exercitation ullamco laboris
nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor
in reprehenderit in voluptate velit esse cillum dolore eu fugiat
nulla pariatur.
:::

::::::




#### Stadteile über die Zeit

```{r message = F, echo = F, fig.asp=.5}
Verlauf = airbnb %>% 
  group_by(Stadtteil) %>% 
  arrange(Erstellungsdatum) %>% 
  mutate(Datum = Erstellungsdatum, 
         Kumulativ = 1:n()) %>% 
  ggplot(aes(x = Datum, y = Kumulativ, col = Stadtteil)) + 
  geom_line() 

(Verlauf + theme(legend.position="none") | Verlauf + scale_y_continuous(trans = 'log')) & 
  labs(y = 'Kumulative Häufigkeit') 

```

#### Karte

You can also embed plots, for example:

```{r echo = F, fig.asp=.6}
ggmap(berlin) + 
  theme(axis.title = element_blank(),
        axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  coord_map(ylim=c(52.45,52.58)) +
  geom_point(airbnb, mapping = aes(x = Längengrad, y = Breitengrad,col=Stadtteil),size=.1)
```
