---
title: "Markdown IV"
author: "<table style='table-layout:fixed;width:100%;border:0;padding:0;margin:0'><col width='10%'><col width='10%'>
  <tr style='border:none'>
    <td style='display:block;width:100%;text-align:left;vertical-align:bottom;padding:0;margin:0;border:none' nowrap>
      <font style='font-style:normal'>Reporting mit R</font><br>
      <a href='https://therbootcamp.github.io/SmR_2020Jun/'>
        <i class='fas fa-clock' style='font-size:.9em;' ></i>
      </a>
      <a href='https://therbootcamp.github.io'>
        <i class='fas fa-home' style='font-size:.9em;'></i>
      </a>
      <a href='mailto:therbootcamp@gmail.com'>
        <i class='fas fa-envelope' style='font-size: .9em;'></i>
      </a>
      <a href='https://www.linkedin.com/company/basel-r-bootcamp/'>
        <i class='fab fa-linkedin' style='font-size: .9em;'></i>
      </a>
      <a href='https://therbootcamp.github.io'>
        <font style='font-style:normal'>The R Bootcamp</font>
      </a>
    </td>
    <td style='width:100%;vertical-align:bottom;text-align:right;padding:0;margin:0;border:none'>
      <img src='https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png' style='height:15px;width:80px'/>
    </td>
  </tr></table>"
output:
  html_document:
    css: practical.css
    self_contained: no
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(comment = NA, 
                      fig.width = 6, 
                      fig.height = 6,
                      fig.align = 'center',
                      echo = FALSE, 
                      eval = FALSE, 
                      warning = FALSE)

options(digits = 3)

# Load packages
library(tidyverse)
```

<p align="center" width="100%">
  <img src="image/design.png" alt="Style" style="width:100%">
  <br>
  <font style="font-size:10px">from <a href="https://dvisiondesign.net/2019/09/25/what-does-design-mean/">dvisiondesign.net</a></font>
</p>


# {.tabset}

## Überblick

In diesem Practical wirst aus deinem fertigen HTML RMarkdown Dokument eine Präsentation erstellen. 
Am Ende des Practicals kann du: 

1. Eine HTML Präsentation mit `iosslides` erstellen und Inhalte mit RMarkdown Code einfügen.
2. Ein Logo einfügen und das Layout der Präsentation anpassen.
3. Du wirst HTML Tags und CSS (Cascading Style Sheets) für die Feinjustierung der Slides verwenden.

## Aufgaben

### A - Setup

1. Öffne dein `TheRBootcamp` R Projekt. Es sollte die Ordner `1_Data`, `2_Assets`, und `3_Markdown` enthalten. 

2. Öffne ein neues RMarkdown Skript und wähle das Presentation - Template "HTML" aus (siehe screenshot unten).

<p align="center" width="100%">
  <img src="image/markdown_presentation.menu.png" alt="Trulli" style="height:200px">
</p>

3. Trage als Titel `Berlin` ein.

4. Lösche alles unterhalb des `setup` R chunks.

5. Speichere das neue Markdown Skript unter dem Namen `presentation_practical.Rmd` im `3_Markdown` Ordner ab.

### B - YAML

Im YAML header wirst du nun die generellen Einstellungen des Dokumentes anpassen.

1. Füge unter `title: Berlin`, in einer neuen Zeilte, einen Untertitel ein.

```R
subtitle: "Bericht: 18/19"
```

2. Um ein Logo automatisch auf dem Titelslide und in der Fussnote jedes Slides anzuzeigen, gib an wo das Logo abgelegt ist.

```R
logo: ../2_Assets/airbnb.png
```

3. Um das Layout (Schrift, genaue Position der Komponenten) im Detail zu gestalten, füge den Link zu einem CSS file in der nächsten Zeile ein.

```R
css: ../2_Assets/airbnb_presentation.css
```

4. Achte auf die korrekten Einrückungen! Der YAML Header sollte so aussehen:

```R
---
title: "Berlin"
subtitle: "Bericht 18/19"
output: 
  ioslides_presentation:
    logo: ../2_Assets/airbnb.png
    css: ../2_Assets/airbnb_presentation.css
---
```


5. `Knitte` das Dokument. Es sollte ein, in den AirBnB Farben gestalteter Titelslide angezeigt werden, mit rote, AirBnB Logo. 

### C - Setup chunk

Nun wirst du im `Setup` Chunk die notwendigen Pakete laden, Daten laden und verschiedenen Einstellungen vornehmen.

1. Ersetze in `knitr::opts_chunk$set` `include=FALSE` mit folgenden Einstellungen:

```R
echo = FALSE, message = FALSE, warning = FALSE
```

2. Lade die folgenden Pakete:

```R
library(tidyverse)
library(lubridate)
library(sjPlot)
library(knitr)
library(kableExtra)
```

2. Integriere die Daten aus dem AirBnB Datensatz für den Zeitraum 2018-2019.

```R
# Lade Daten
airbnb_1819 <- read_csv('../1_Data/airbnb.csv') %>% 
  filter(Erstellungsdatum > "2018-01-01", 
         Erstellungsdatum < "2019-12-31")
```

3. Passe das Grafik Theme für `ggplot` an. Damit veränderst du den Hintergrund aller Grafiken 
und optimierst die Schriftgrösse der Grafiken.

```R
# Ändere Thema zu minimal
theme_set(theme_minimal())
theme_update(panel.background = element_rect(fill = "transparent", colour = NA),
             plot.background = element_rect(fill = "transparent", colour = NA),
             axis.title.x = element_text(size = 16), 
             text = element_text(size=19))
```

4. Für die `ggplot` Grafiken wirst du nun noch die Farben an die AirBnB Palette anpassen.

```R
# Setze defaults in ggplot
ggplot <- function(...) ggplot2::ggplot(...) + 
  scale_fill_gradientn(colors = c('#555555','#6BB7B9')) + 
  scale_colour_gradientn(colors = c('#555555','#6BB7B9'))
```

### D - Nun gehts an die Slides

1. new zwischenslide `# wekfj`

2. knitten ...

3. new slide `##`

4. Seit `r strftime(min(airbnb_1819$Erstellungsdatum), "%d.%m.%Y")` wurden in Berlin:

5. include stuff


```R
Seit `r strftime(min(airbnb_1819$Erstellungsdatum), "%d.%m.%Y")` wurden in Berlin:

> - `r nrow(airbnb_1819)` Airbnb Wohnungen eingestellt
> - `r round(mean(airbnb_1819$Verfügbarkeit_90Tage > 0) * 100)`% haben Verfügbarkeiten von durchschnittlich `r round(mean(airbnb_1819$Verfügbarkeit_90Tage[airbnb_1819$Verfügbarkeit_90Tage>0]),1)` Tagen
> - 2019 wurden insgesamt `r n_2019 = sum(year(airbnb_1819$Erstellungsdatum) == 2019); n_2019` neue Wohnungen eingestellt
> - 2018 nur `r n_2018 = sum(year(airbnb_1819$Erstellungsdatum) == 2018); n_2018` Wohnungen eingestellt
> - Zuwachs: `r (round(n_2019/n_2018, 2) - 1)*100`%

```

6. knitten all good?

7. new slie `##`

8. include chunk

```R
```{r  fig.asp=.6, fig.cap = cap}
# Plotte Häufigkeiten
ggplot(airbnb_1819 %>% 
         group_by(Jahr = year(Erstellungsdatum), 
                  Monat_tmp = month(Erstellungsdatum)) %>% 
         summarize(
           Monat = as_factor(paste(first(Jahr), first(Monat_tmp), sep = '-')),
           Wohnungen = n()), 
       aes(x = Monat, y = Wohnungen, fill = Jahr)) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  theme(legend.position = 'none',
        axis.text.x = element_text(angle = 45, hjust = 1)) 

# Ergänze caption
cap = "<center>Figure 1. Neueinstellungen pro Monat</center>"
```
```

9. knitten. all good.

### E - Second couple of slides

1. new slide

2. include stuff

```R
# Berechne Häufigkeiten über die Bezirke
stadtteile <- airbnb_1819 %>% 
         group_by(Stadtteil, 
                  Jahr = year(Erstellungsdatum)) %>% 
         summarize(Wohnungen = n()) %>% 
  ungroup() %>% 
  arrange(desc(Jahr), Wohnungen) %>% 
  mutate(Stadtteil = as_factor(Stadtteil))

# Veränderung über die Stadtteile
veränderung = stadtteile %>% 
  group_by(Stadtteil) %>% 
  summarize(veränderung = (100 * (Wohnungen[Jahr == 2019]/Wohnungen[Jahr == 2018] - 1)) %>% round(1))

# Geringsten Veränderung
min_veränderung = veränderung %>% 
  slice(which.min(veränderung)) %>% 
  pull(veränderung)

# Stadteil mit der geringsten Veränderung
min_stadtteil = veränderung %>% 
  slice(which.min(veränderung)) %>% 
  pull(Stadtteil)

# Grösste Veränderung
max_veränderung = veränderung %>% 
  slice(which.max(veränderung)) %>% 
  pull(veränderung)

# Stadteil mit der grössten Veränderung
max_stadtteil = veränderung %>% 
  slice(which.max(veränderung)) %>% 
  pull(Stadtteil)
```

3. include stuff

```R
- Meisten Neueinstellungen: `r stadtteile %>% filter(Jahr == 2019) %>% pull(Stadtteil) %>% last()`
- Wenigste Neueinstellungen:  `r stadtteile %>% filter(Jahr == 2019) %>% pull(Stadtteil) %>% first()`
- Grössten Reduktion mit  `r min_veränderung`% in `r min_stadtteil` 
- Grösster Zuwachs mit `r max_veränderung`% in `r max_stadtteil` 
```

4. new slide

5. include stuff

```R
# Plotte Häufigkeieten der Stadtteile
ggplot(stadtteile, 
       aes(y = Stadtteil, x = Wohnungen, group = Jahr, fill = Jahr)) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  theme(legend.position = 'none') + labs(y='')

# Ergänze caption
cap = "<center>Figure 2. Neueinstellungen pro Bezirk</center>"
```

### E - third couple of slides

1. neuer zwischen sldie

2. new slide

3. include chunk

```R
# Vector mit Ausstatttungsmerkmalen
ausstattung_var <- c('Küche','Wifi','TV','Kaffeemaschine',
                    'Geschirrspüler','Terrasse_Balkon',
                    'Check_in_24h')

# Bestimme Preise als Funktion der Ausstatttungsmerkmale
ausstattung <- airbnb_1819 %>% 
  select(all_of(ausstattung_var), Preis) %>%
  pivot_longer(-Preis,
             names_to = 'Ausstattung',
             values_to = 'Ausstattung_vorhanden') %>% 
  group_by(Ausstattung) %>% 
  summarize(Nicht_vorhanden = mean(Preis[!Ausstattung_vorhanden]),
            Vorhanden = mean(Preis[Ausstattung_vorhanden]),
            Differenz = Vorhanden - Nicht_vorhanden, 
            Prozent_vorhanden = mean(Ausstattung_vorhanden) * 100) %>% 
  arrange(desc(Differenz)) 
```

4. include stuff

```R
- Durchschnittliche Preis der Neueinstellungen `r round(mean(airbnb_1819 %>% pull(Preis)),1)` €
- Anstieg der Preise um `r m <- mean(airbnb_1819 %>% filter(year(Erstellungsdatum) == 2019) %>% pull(Preis))/mean(airbnb_1819 %>% filter(year(Erstellungsdatum) == 2018) %>% pull(Preis)) ; round(m, 3) * 100 - 100`%
- Grössten Unterschied im Preis `r ausstattung %>% pull(Ausstattung) %>% first()` (`r ausstattung %>% pull(Differenz) %>% first() %>% round(1)`)
- Kleinster Unterschied im Preis `r ausstattung %>% pull(Ausstattung) %>% last()` (`r ausstattung %>% pull(Differenz) %>% last() %>% round(1)`)
```



## Datensatz

Der [airbnb.csv](https://raw.githubusercontent.com/therbootcamp/RmR_2020Apr/master/_materials/case/airbnb.csv) Datensatz enthält Zahlen zu 9868 Berliner Airbnbs 


|Variable | Beschreibung |
|:-------------|:-------------------------------------|
|Preis| Preis pro Nacht|
 |Erstellungsdatum| Eröffnungsdatum des Airbnbs |
 |Unterkunftsart| Appartement, Loft, House, etc.|
 |Schlafplätze| Anzahl Schlafplätze |
 |Schlafzimmer| Anzahl Schlafzimmer |
 |Badezimmer| Anzahl Badezimmer |
 |Reinigungsgebühr| Reinigungsgebühr |
 |Verfügbarkeit_90Tage| |
 |Viertel| In welchem Viertel befindet sich das Airbnb |
 |Stadtteil| In welchem Stadtteil befindet sich das Airbnb |
 |Breitengrad| Breitengrad|
 |Längengrad| Längengrad |
 |Host_id| Host id |
 |Host_seit| Erfahrung des Hosts |
 |Host_antwortzeit| Host Antwortzeit|
 |Host_antwortrate| Host Antwortrate |
 |Host_superhost| Superhost Ja/Nein |
 |Host_anzahl| Anzahl Gäste |
 |Rating_gesamt| Gesamtrating |
 |Rating_genauigkeit| Genauigkeitsrating |
 |Rating_sauberkeit| Sauberkeitsrating |
 |Rating_checkin| Checkinrating |
 |Rating_kommunikation| Kommunikationsrating |
 |Rating_lage| Lagerating |
 |Rating_wertigkeit| Wertigkeitsrating |
 |Küche| Küche vorhanden TRUE/FALSE |
 |Wifi| WLAN vorhanden TRUE/FALSE |
 |TV| TV vorhanden TRUE/FALSE |
 |Kaffeemaschine| Kaffeemaschine vorhanden TRUE/FALSE|
 |Geschirrspüler| Geschirrspüler vorhanden TRUE/FALSE|
 |Terrasse_Balkon| Terrasse/Balkon vorhanden TRUE/FALSE|
 |Badewanne| Badewanne vorhanden TRUE/FALSE|
 |Check_in_24h| 24h Check-In vorhanden TRUE/FALSE|



## Funktionen

### Paket

|Paket| Installation|
|:------|:------|
|`tidyverse`|`install.packages("tidyverse")`|



### Funktionen


| Funktion| Paket | Beschreibung |
|:---|:------|:---------------------------------------------|
| ``|``|  | 



## Materialien

- ...
- ...